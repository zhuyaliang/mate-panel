
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cppcheck - HTML report - mate-panel</title>
    <link rel="stylesheet" href="style.css">
    <style>
pre { line-height: 125%; }
td.linenos pre { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
span.linenos { color: #000000; background-color: #f0f0f0; padding-left: 5px; padding-right: 5px; }
td.linenos pre.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .ch { color: #888888 } /* Comment.Hashbang */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .cpf { color: #888888 } /* Comment.PreprocFile */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sa { background-color: #fff0f0 } /* Literal.String.Affix */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .dl { background-color: #fff0f0 } /* Literal.String.Delimiter */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0066BB; font-weight: bold } /* Name.Function.Magic */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .vm { color: #996633 } /* Name.Variable.Magic */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
    </style>
    <script>
      function getStyle(el, styleProp) {
        var y;

        if (el.currentStyle) {
          y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
          y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }

        return y;
      }

      function toggle() {
        var el = this.expandable_content;
        var mark = this.expandable_marker;

        if (el.style.display === "block") {
          el.style.display = "none";
          mark.textContent = "[+]";
        } else {
          el.style.display = "block";
          mark.textContent = "[-]";
        }
      }

      function initExpandables() {
        var elements = document.querySelectorAll(".expandable");

        for (var i = 0, len = elements.length; i < len; i++) {
          var el = elements[i];
          var clickable = el.querySelector("span");
          var marker = clickable.querySelector(".marker");
          var content = el.querySelector(".content");
          var width = clickable.clientWidth - parseInt(getStyle(content, "padding-left")) - parseInt(getStyle(content, "padding-right"));
          content.style.width = width + "px";
          clickable.expandable_content = content;
          clickable.expandable_marker = marker;
          clickable.addEventListener("click", toggle);
        }
      }

      function toggleDisplay(id) {
        var elements = document.querySelectorAll("." + id);

        for (var i = 0, len = elements.length; i < len; i++) {
          elements[i].classList.toggle("d-none");
        }
      }

      function toggleAll() {
        var elements = document.querySelectorAll("input");

        // starting from 1 since 0 is the "toggle all" input
        for (var i = 1, len = elements.length; i < len; i++) {
          var el = elements[i];

          if (el.checked) {
            el.checked = false;
          } else {
            el.checked = true;
          }

          toggleDisplay(el.id);
        }
      }
      window.addEventListener("load", initExpandables);
    </script>
  </head>
  <body>
    <div id="header" class="header">
      <h1>Cppcheck report - mate-panel: mate-panel/mate-submodules/libegg/eggsmclient.c</h1>
    </div>
    <div class="wrapper">
      <div id="menu">
       <p id="filename"><a href="index.html">Defects:</a> eggsmclient.c</p>
<a href="18.html#line-350"> knownConditionTrueFalse 350</a><a href="18.html#line-350"> knownConditionTrueFalse 350</a><a href="18.html#line-362"> knownConditionTrueFalse 362</a><a href="18.html#line-370"> knownConditionTrueFalse 370</a>
    </div>
    <div id="content">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643</pre></div></td><td class="code"><div class="highlight"><pre><span></span><a name="line-1"></a><span class="cm">/*</span>
<a name="line-2"></a><span class="cm"> * Copyright (C) 2007 Novell, Inc.</span>
<a name="line-3"></a><span class="cm"> *</span>
<a name="line-4"></a><span class="cm"> * This library is free software; you can redistribute it and/or</span>
<a name="line-5"></a><span class="cm"> * modify it under the terms of the GNU Library General Public</span>
<a name="line-6"></a><span class="cm"> * License as published by the Free Software Foundation; either</span>
<a name="line-7"></a><span class="cm"> * version 2 of the License, or (at your option) any later version.</span>
<a name="line-8"></a><span class="cm"> *</span>
<a name="line-9"></a><span class="cm"> * This library is distributed in the hope that it will be useful,</span>
<a name="line-10"></a><span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="line-11"></a><span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<a name="line-12"></a><span class="cm"> * Library General Public License for more details.</span>
<a name="line-13"></a><span class="cm"> *</span>
<a name="line-14"></a><span class="cm"> * You should have received a copy of the GNU Library General Public</span>
<a name="line-15"></a><span class="cm"> * License along with this library; if not, write to the</span>
<a name="line-16"></a><span class="cm"> * Free Software Foundation, Inc., 51 Franklin St, Fifth Floor,</span>
<a name="line-17"></a><span class="cm"> * Boston, MA 02110-1301, USA.</span>
<a name="line-18"></a><span class="cm"> */</span>
<a name="line-19"></a>
<a name="line-20"></a><span class="cp">#include</span> <span class="cpf">&quot;config.h&quot;</span><span class="cp"></span>
<a name="line-21"></a>
<a name="line-22"></a><span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>
<a name="line-23"></a><span class="cp">#include</span> <span class="cpf">&lt;glib/gi18n.h&gt;</span><span class="cp"></span>
<a name="line-24"></a>
<a name="line-25"></a><span class="cp">#include</span> <span class="cpf">&quot;eggsmclient.h&quot;</span><span class="cp"></span>
<a name="line-26"></a><span class="cp">#include</span> <span class="cpf">&quot;eggsmclient-private.h&quot;</span><span class="cp"></span>
<a name="line-27"></a>
<a name="line-28"></a><span class="k">static</span> <span class="kt">void</span> <span class="n">egg_sm_client_debug_handler</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">log_domain</span><span class="p">,</span>
<a name="line-29"></a>        <span class="n">GLogLevelFlags</span> <span class="n">log_level</span><span class="p">,</span>
<a name="line-30"></a>        <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span>
<a name="line-31"></a>        <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">);</span>
<a name="line-32"></a>
<a name="line-33"></a><span class="k">enum</span>
<a name="line-34"></a><span class="p">{</span>
<a name="line-35"></a>    <span class="n">SAVE_STATE</span><span class="p">,</span>
<a name="line-36"></a>    <span class="n">QUIT_REQUESTED</span><span class="p">,</span>
<a name="line-37"></a>    <span class="n">QUIT_CANCELLED</span><span class="p">,</span>
<a name="line-38"></a>    <span class="n">QUIT</span><span class="p">,</span>
<a name="line-39"></a>    <span class="n">LAST_SIGNAL</span>
<a name="line-40"></a><span class="p">};</span>
<a name="line-41"></a>
<a name="line-42"></a><span class="k">static</span> <span class="n">guint</span> <span class="n">signals</span><span class="p">[</span><span class="n">LAST_SIGNAL</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
<a name="line-43"></a>
<a name="line-44"></a><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
<a name="line-45"></a>    <span class="n">GKeyFile</span> <span class="o">*</span><span class="n">state_file</span><span class="p">;</span>
<a name="line-46"></a><span class="p">}</span><span class="n">EggSMClientPrivate</span><span class="p">;</span>
<a name="line-47"></a>
<a name="line-48"></a><span class="n">G_DEFINE_TYPE_WITH_PRIVATE</span> <span class="p">(</span><span class="n">EggSMClient</span><span class="p">,</span> <span class="n">egg_sm_client</span><span class="p">,</span> <span class="n">G_TYPE_OBJECT</span><span class="p">)</span>
<a name="line-49"></a>
<a name="line-50"></a><span class="k">static</span> <span class="n">EggSMClient</span> <span class="o">*</span><span class="n">global_client</span><span class="p">;</span>
<a name="line-51"></a><span class="k">static</span> <span class="n">EggSMClientMode</span> <span class="n">global_client_mode</span> <span class="o">=</span> <span class="n">EGG_SM_CLIENT_MODE_NORMAL</span><span class="p">;</span>
<a name="line-52"></a>
<a name="line-53"></a><span class="k">static</span> <span class="n">gboolean</span>
<a name="line-54"></a><span class="n">running_in_mate</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a name="line-55"></a><span class="p">{</span>
<a name="line-56"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">g_strcmp0</span> <span class="p">(</span><span class="n">g_getenv</span> <span class="p">(</span><span class="s">&quot;XDG_CURRENT_DESKTOP&quot;</span><span class="p">),</span> <span class="s">&quot;MATE&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-57"></a>        <span class="o">||</span> <span class="p">(</span><span class="n">g_strcmp0</span> <span class="p">(</span><span class="n">g_getenv</span> <span class="p">(</span><span class="s">&quot;XDG_SESSION_DESKTOP&quot;</span><span class="p">),</span> <span class="s">&quot;mate&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-58"></a>        <span class="o">||</span> <span class="p">(</span><span class="n">g_strcmp0</span> <span class="p">(</span><span class="n">g_getenv</span> <span class="p">(</span><span class="s">&quot;DESKTOP_SESSION&quot;</span><span class="p">),</span> <span class="s">&quot;mate&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-59"></a><span class="p">}</span>
<a name="line-60"></a>
<a name="line-61"></a><span class="k">static</span> <span class="kt">void</span>
<a name="line-62"></a><span class="n">egg_sm_client_init</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-63"></a><span class="p">{</span>
<a name="line-64"></a>    <span class="p">;</span>
<a name="line-65"></a><span class="p">}</span>
<a name="line-66"></a>
<a name="line-67"></a><span class="k">static</span> <span class="kt">void</span>
<a name="line-68"></a><span class="n">egg_sm_client_class_init</span> <span class="p">(</span><span class="n">EggSMClientClass</span> <span class="o">*</span><span class="n">klass</span><span class="p">)</span>
<a name="line-69"></a><span class="p">{</span>
<a name="line-70"></a>    <span class="n">GObjectClass</span> <span class="o">*</span><span class="n">object_class</span> <span class="o">=</span> <span class="n">G_OBJECT_CLASS</span> <span class="p">(</span><span class="n">klass</span><span class="p">);</span>
<a name="line-71"></a>
<a name="line-72"></a>    <span class="cm">/**</span>
<a name="line-73"></a><span class="cm">     * EggSMClient::save_state:</span>
<a name="line-74"></a><span class="cm">     * @client: the client</span>
<a name="line-75"></a><span class="cm">     * @state_file: a #GKeyFile to save state information into</span>
<a name="line-76"></a><span class="cm">     *</span>
<a name="line-77"></a><span class="cm">     * Emitted when the session manager has requested that the</span>
<a name="line-78"></a><span class="cm">     * application save information about its current state. The</span>
<a name="line-79"></a><span class="cm">     * application should save its state into @state_file, and then the</span>
<a name="line-80"></a><span class="cm">     * session manager may then restart the application in a future</span>
<a name="line-81"></a><span class="cm">     * session and tell it to initialize itself from that state.</span>
<a name="line-82"></a><span class="cm">     *</span>
<a name="line-83"></a><span class="cm">     * You should not save any data into @state_file&#39;s &quot;start group&quot;</span>
<a name="line-84"></a><span class="cm">     * (ie, the %NULL group). Instead, applications should save their</span>
<a name="line-85"></a><span class="cm">     * data into groups with names that start with the application name,</span>
<a name="line-86"></a><span class="cm">     * and libraries that connect to this signal should save their data</span>
<a name="line-87"></a><span class="cm">     * into groups with names that start with the library name.</span>
<a name="line-88"></a><span class="cm">     *</span>
<a name="line-89"></a><span class="cm">     * Alternatively, rather than (or in addition to) using @state_file,</span>
<a name="line-90"></a><span class="cm">     * the application can save its state by calling</span>
<a name="line-91"></a><span class="cm">     * egg_sm_client_set_restart_command() during the processing of this</span>
<a name="line-92"></a><span class="cm">     * signal (eg, to include a list of files to open).</span>
<a name="line-93"></a><span class="cm">     **/</span>
<a name="line-94"></a>    <span class="n">signals</span><span class="p">[</span><span class="n">SAVE_STATE</span><span class="p">]</span> <span class="o">=</span>
<a name="line-95"></a>        <span class="n">g_signal_new</span> <span class="p">(</span><span class="s">&quot;save_state&quot;</span><span class="p">,</span>
<a name="line-96"></a>                      <span class="n">G_OBJECT_CLASS_TYPE</span> <span class="p">(</span><span class="n">object_class</span><span class="p">),</span>
<a name="line-97"></a>                      <span class="n">G_SIGNAL_RUN_LAST</span><span class="p">,</span>
<a name="line-98"></a>                      <span class="n">G_STRUCT_OFFSET</span> <span class="p">(</span><span class="n">EggSMClientClass</span><span class="p">,</span> <span class="n">save_state</span><span class="p">),</span>
<a name="line-99"></a>                      <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
<a name="line-100"></a>                      <span class="n">g_cclosure_marshal_VOID__POINTER</span><span class="p">,</span>
<a name="line-101"></a>                      <span class="n">G_TYPE_NONE</span><span class="p">,</span>
<a name="line-102"></a>                      <span class="mi">1</span><span class="p">,</span> <span class="n">G_TYPE_POINTER</span><span class="p">);</span>
<a name="line-103"></a>
<a name="line-104"></a>    <span class="cm">/**</span>
<a name="line-105"></a><span class="cm">     * EggSMClient::quit_requested:</span>
<a name="line-106"></a><span class="cm">     * @client: the client</span>
<a name="line-107"></a><span class="cm">     *</span>
<a name="line-108"></a><span class="cm">     * Emitted when the session manager requests that the application</span>
<a name="line-109"></a><span class="cm">     * exit (generally because the user is logging out). The application</span>
<a name="line-110"></a><span class="cm">     * should decide whether or not it is willing to quit (perhaps after</span>
<a name="line-111"></a><span class="cm">     * asking the user what to do with documents that have unsaved</span>
<a name="line-112"></a><span class="cm">     * changes) and then call egg_sm_client_will_quit(), passing %TRUE</span>
<a name="line-113"></a><span class="cm">     * or %FALSE to give its answer to the session manager. (It does not</span>
<a name="line-114"></a><span class="cm">     * need to give an answer before returning from the signal handler;</span>
<a name="line-115"></a><span class="cm">     * it can interact with the user asynchronously and then give its</span>
<a name="line-116"></a><span class="cm">     * answer later on.) If the application does not connect to this</span>
<a name="line-117"></a><span class="cm">     * signal, then #EggSMClient will automatically return %TRUE on its</span>
<a name="line-118"></a><span class="cm">     * behalf.</span>
<a name="line-119"></a><span class="cm">     *</span>
<a name="line-120"></a><span class="cm">     * The application should not save its session state as part of</span>
<a name="line-121"></a><span class="cm">     * handling this signal; if the user has requested that the session</span>
<a name="line-122"></a><span class="cm">     * be saved when logging out, then ::save_state will be emitted</span>
<a name="line-123"></a><span class="cm">     * separately.</span>
<a name="line-124"></a><span class="cm">     *</span>
<a name="line-125"></a><span class="cm">     * If the application agrees to quit, it should then wait for either</span>
<a name="line-126"></a><span class="cm">     * the ::quit_cancelled or ::quit signals to be emitted.</span>
<a name="line-127"></a><span class="cm">     **/</span>
<a name="line-128"></a>    <span class="n">signals</span><span class="p">[</span><span class="n">QUIT_REQUESTED</span><span class="p">]</span> <span class="o">=</span>
<a name="line-129"></a>        <span class="n">g_signal_new</span> <span class="p">(</span><span class="s">&quot;quit_requested&quot;</span><span class="p">,</span>
<a name="line-130"></a>                      <span class="n">G_OBJECT_CLASS_TYPE</span> <span class="p">(</span><span class="n">object_class</span><span class="p">),</span>
<a name="line-131"></a>                      <span class="n">G_SIGNAL_RUN_LAST</span><span class="p">,</span>
<a name="line-132"></a>                      <span class="n">G_STRUCT_OFFSET</span> <span class="p">(</span><span class="n">EggSMClientClass</span><span class="p">,</span> <span class="n">quit_requested</span><span class="p">),</span>
<a name="line-133"></a>                      <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
<a name="line-134"></a>                      <span class="n">g_cclosure_marshal_VOID__VOID</span><span class="p">,</span>
<a name="line-135"></a>                      <span class="n">G_TYPE_NONE</span><span class="p">,</span>
<a name="line-136"></a>                      <span class="mi">0</span><span class="p">);</span>
<a name="line-137"></a>
<a name="line-138"></a>    <span class="cm">/**</span>
<a name="line-139"></a><span class="cm">     * EggSMClient::quit_cancelled:</span>
<a name="line-140"></a><span class="cm">     * @client: the client</span>
<a name="line-141"></a><span class="cm">     *</span>
<a name="line-142"></a><span class="cm">     * Emitted when the session manager decides to cancel a logout after</span>
<a name="line-143"></a><span class="cm">     * the application has already agreed to quit. After receiving this</span>
<a name="line-144"></a><span class="cm">     * signal, the application can go back to what it was doing before</span>
<a name="line-145"></a><span class="cm">     * receiving the ::quit_requested signal.</span>
<a name="line-146"></a><span class="cm">     **/</span>
<a name="line-147"></a>    <span class="n">signals</span><span class="p">[</span><span class="n">QUIT_CANCELLED</span><span class="p">]</span> <span class="o">=</span>
<a name="line-148"></a>        <span class="n">g_signal_new</span> <span class="p">(</span><span class="s">&quot;quit_cancelled&quot;</span><span class="p">,</span>
<a name="line-149"></a>                      <span class="n">G_OBJECT_CLASS_TYPE</span> <span class="p">(</span><span class="n">object_class</span><span class="p">),</span>
<a name="line-150"></a>                      <span class="n">G_SIGNAL_RUN_LAST</span><span class="p">,</span>
<a name="line-151"></a>                      <span class="n">G_STRUCT_OFFSET</span> <span class="p">(</span><span class="n">EggSMClientClass</span><span class="p">,</span> <span class="n">quit_cancelled</span><span class="p">),</span>
<a name="line-152"></a>                      <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
<a name="line-153"></a>                      <span class="n">g_cclosure_marshal_VOID__VOID</span><span class="p">,</span>
<a name="line-154"></a>                      <span class="n">G_TYPE_NONE</span><span class="p">,</span>
<a name="line-155"></a>                      <span class="mi">0</span><span class="p">);</span>
<a name="line-156"></a>
<a name="line-157"></a>    <span class="cm">/**</span>
<a name="line-158"></a><span class="cm">     * EggSMClient::quit:</span>
<a name="line-159"></a><span class="cm">     * @client: the client</span>
<a name="line-160"></a><span class="cm">     *</span>
<a name="line-161"></a><span class="cm">     * Emitted when the session manager wants the application to quit</span>
<a name="line-162"></a><span class="cm">     * (generally because the user is logging out). The application</span>
<a name="line-163"></a><span class="cm">     * should exit as soon as possible after receiving this signal; if</span>
<a name="line-164"></a><span class="cm">     * it does not, the session manager may choose to forcibly kill it.</span>
<a name="line-165"></a><span class="cm">     *</span>
<a name="line-166"></a><span class="cm">     * Normally a GUI application would only be sent a ::quit if it</span>
<a name="line-167"></a><span class="cm">     * agreed to quit in response to a ::quit_requested signal. However,</span>
<a name="line-168"></a><span class="cm">     * this is not guaranteed; in some situations the session manager</span>
<a name="line-169"></a><span class="cm">     * may decide to end the session without giving applications a</span>
<a name="line-170"></a><span class="cm">     * chance to object.</span>
<a name="line-171"></a><span class="cm">     **/</span>
<a name="line-172"></a>    <span class="n">signals</span><span class="p">[</span><span class="n">QUIT</span><span class="p">]</span> <span class="o">=</span>
<a name="line-173"></a>        <span class="n">g_signal_new</span> <span class="p">(</span><span class="s">&quot;quit&quot;</span><span class="p">,</span>
<a name="line-174"></a>                      <span class="n">G_OBJECT_CLASS_TYPE</span> <span class="p">(</span><span class="n">object_class</span><span class="p">),</span>
<a name="line-175"></a>                      <span class="n">G_SIGNAL_RUN_LAST</span><span class="p">,</span>
<a name="line-176"></a>                      <span class="n">G_STRUCT_OFFSET</span> <span class="p">(</span><span class="n">EggSMClientClass</span><span class="p">,</span> <span class="n">quit</span><span class="p">),</span>
<a name="line-177"></a>                      <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
<a name="line-178"></a>                      <span class="n">g_cclosure_marshal_VOID__VOID</span><span class="p">,</span>
<a name="line-179"></a>                      <span class="n">G_TYPE_NONE</span><span class="p">,</span>
<a name="line-180"></a>                      <span class="mi">0</span><span class="p">);</span>
<a name="line-181"></a><span class="p">}</span>
<a name="line-182"></a>
<a name="line-183"></a><span class="k">static</span> <span class="n">gboolean</span> <span class="n">sm_client_disable</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">;</span>
<a name="line-184"></a><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sm_client_state_file</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-185"></a><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sm_client_id</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-186"></a><span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sm_config_prefix</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-187"></a>
<a name="line-188"></a><span class="k">static</span> <span class="n">gboolean</span>
<a name="line-189"></a><span class="n">sm_client_post_parse_func</span> <span class="p">(</span><span class="n">GOptionContext</span>  <span class="o">*</span><span class="n">context</span><span class="p">,</span>
<a name="line-190"></a>                           <span class="n">GOptionGroup</span>    <span class="o">*</span><span class="n">group</span><span class="p">,</span>
<a name="line-191"></a>                           <span class="n">gpointer</span>         <span class="n">data</span><span class="p">,</span>
<a name="line-192"></a>                           <span class="n">GError</span>         <span class="o">**</span><span class="n">error</span><span class="p">)</span>
<a name="line-193"></a><span class="p">{</span>
<a name="line-194"></a>    <span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">egg_sm_client_get</span> <span class="p">();</span>
<a name="line-195"></a>
<a name="line-196"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">sm_client_id</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-197"></a>    <span class="p">{</span>
<a name="line-198"></a>        <span class="k">const</span> <span class="n">gchar</span> <span class="o">*</span><span class="n">desktop_autostart_id</span><span class="p">;</span>
<a name="line-199"></a>
<a name="line-200"></a>        <span class="n">desktop_autostart_id</span> <span class="o">=</span> <span class="n">g_getenv</span> <span class="p">(</span><span class="s">&quot;DESKTOP_AUTOSTART_ID&quot;</span><span class="p">);</span>
<a name="line-201"></a>
<a name="line-202"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">desktop_autostart_id</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
<a name="line-203"></a>            <span class="n">sm_client_id</span> <span class="o">=</span> <span class="n">g_strdup</span> <span class="p">(</span><span class="n">desktop_autostart_id</span><span class="p">);</span>
<a name="line-204"></a>    <span class="p">}</span>
<a name="line-205"></a>
<a name="line-206"></a>    <span class="cm">/* Unset DESKTOP_AUTOSTART_ID in order to avoid child processes to</span>
<a name="line-207"></a><span class="cm">     * use the same client id. */</span>
<a name="line-208"></a>    <span class="n">g_unsetenv</span> <span class="p">(</span><span class="s">&quot;DESKTOP_AUTOSTART_ID&quot;</span><span class="p">);</span>
<a name="line-209"></a>
<a name="line-210"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">global_client_mode</span> <span class="o">!=</span> <span class="n">EGG_SM_CLIENT_MODE_DISABLED</span> <span class="o">&amp;&amp;</span>
<a name="line-211"></a>        <span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span><span class="p">)</span>
<a name="line-212"></a>        <span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">sm_client_id</span><span class="p">);</span>
<a name="line-213"></a>    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<a name="line-214"></a><span class="p">}</span>
<a name="line-215"></a>
<a name="line-216"></a><span class="cm">/**</span>
<a name="line-217"></a><span class="cm"> * egg_sm_client_get_option_group:</span>
<a name="line-218"></a><span class="cm"> *</span>
<a name="line-219"></a><span class="cm"> * Creates a %GOptionGroup containing the session-management-related</span>
<a name="line-220"></a><span class="cm"> * options. You should add this group to the application&#39;s</span>
<a name="line-221"></a><span class="cm"> * %GOptionContext if you want to use #EggSMClient.</span>
<a name="line-222"></a><span class="cm"> *</span>
<a name="line-223"></a><span class="cm"> * Return value: the %GOptionGroup</span>
<a name="line-224"></a><span class="cm"> **/</span>
<a name="line-225"></a><span class="n">GOptionGroup</span> <span class="o">*</span>
<a name="line-226"></a><span class="n">egg_sm_client_get_option_group</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a name="line-227"></a><span class="p">{</span>
<a name="line-228"></a>    <span class="k">const</span> <span class="n">GOptionEntry</span> <span class="n">entries</span><span class="p">[]</span> <span class="o">=</span>
<a name="line-229"></a>    <span class="p">{</span>
<a name="line-230"></a>        <span class="p">{</span>
<a name="line-231"></a>            <span class="s">&quot;sm-client-disable&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<a name="line-232"></a>            <span class="n">G_OPTION_ARG_NONE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sm_client_disable</span><span class="p">,</span>
<a name="line-233"></a>            <span class="n">N_</span><span class="p">(</span><span class="s">&quot;Disable connection to session manager&quot;</span><span class="p">),</span> <span class="nb">NULL</span>
<a name="line-234"></a>        <span class="p">},</span>
<a name="line-235"></a>        <span class="p">{</span>
<a name="line-236"></a>            <span class="s">&quot;sm-client-state-file&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<a name="line-237"></a>            <span class="n">G_OPTION_ARG_FILENAME</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sm_client_state_file</span><span class="p">,</span>
<a name="line-238"></a>            <span class="n">N_</span><span class="p">(</span><span class="s">&quot;Specify file containing saved configuration&quot;</span><span class="p">),</span> <span class="n">N_</span><span class="p">(</span><span class="s">&quot;FILE&quot;</span><span class="p">)</span>
<a name="line-239"></a>        <span class="p">},</span>
<a name="line-240"></a>        <span class="p">{</span>
<a name="line-241"></a>            <span class="s">&quot;sm-client-id&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
<a name="line-242"></a>            <span class="n">G_OPTION_ARG_STRING</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sm_client_id</span><span class="p">,</span>
<a name="line-243"></a>            <span class="n">N_</span><span class="p">(</span><span class="s">&quot;Specify session management ID&quot;</span><span class="p">),</span> <span class="n">N_</span><span class="p">(</span><span class="s">&quot;ID&quot;</span><span class="p">)</span>
<a name="line-244"></a>        <span class="p">},</span>
<a name="line-245"></a>        <span class="cm">/* MateClient compatibility option */</span>
<a name="line-246"></a>        <span class="p">{</span>
<a name="line-247"></a>            <span class="s">&quot;sm-disable&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">G_OPTION_FLAG_HIDDEN</span><span class="p">,</span>
<a name="line-248"></a>            <span class="n">G_OPTION_ARG_NONE</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sm_client_disable</span><span class="p">,</span>
<a name="line-249"></a>            <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span>
<a name="line-250"></a>        <span class="p">},</span>
<a name="line-251"></a>        <span class="cm">/* MateClient compatibility option. This is a dummy option that only</span>
<a name="line-252"></a><span class="cm">         * exists so that sessions saved by apps with MateClient can be restored</span>
<a name="line-253"></a><span class="cm">         * later when they&#39;ve switched to EggSMClient. See bug #575308.</span>
<a name="line-254"></a><span class="cm">         */</span>
<a name="line-255"></a>        <span class="p">{</span>
<a name="line-256"></a>            <span class="s">&quot;sm-config-prefix&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">G_OPTION_FLAG_HIDDEN</span><span class="p">,</span>
<a name="line-257"></a>            <span class="n">G_OPTION_ARG_STRING</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sm_config_prefix</span><span class="p">,</span>
<a name="line-258"></a>            <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span>
<a name="line-259"></a>        <span class="p">},</span>
<a name="line-260"></a>        <span class="p">{</span> <span class="nb">NULL</span> <span class="p">}</span>
<a name="line-261"></a>    <span class="p">};</span>
<a name="line-262"></a>    <span class="n">GOptionGroup</span> <span class="o">*</span><span class="n">group</span><span class="p">;</span>
<a name="line-263"></a>
<a name="line-264"></a>    <span class="cm">/* Use our own debug handler for the &quot;EggSMClient&quot; domain. */</span>
<a name="line-265"></a>    <span class="n">g_log_set_handler</span> <span class="p">(</span><span class="n">G_LOG_DOMAIN</span><span class="p">,</span> <span class="n">G_LOG_LEVEL_DEBUG</span><span class="p">,</span>
<a name="line-266"></a>                       <span class="n">egg_sm_client_debug_handler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-267"></a>
<a name="line-268"></a>    <span class="n">group</span> <span class="o">=</span> <span class="n">g_option_group_new</span> <span class="p">(</span><span class="s">&quot;sm-client&quot;</span><span class="p">,</span>
<a name="line-269"></a>                                <span class="n">_</span><span class="p">(</span><span class="s">&quot;Session management options:&quot;</span><span class="p">),</span>
<a name="line-270"></a>                                <span class="n">_</span><span class="p">(</span><span class="s">&quot;Show session management options&quot;</span><span class="p">),</span>
<a name="line-271"></a>                                <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-272"></a>    <span class="n">g_option_group_add_entries</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">entries</span><span class="p">);</span>
<a name="line-273"></a>    <span class="n">g_option_group_set_parse_hooks</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">sm_client_post_parse_func</span><span class="p">);</span>
<a name="line-274"></a>
<a name="line-275"></a>    <span class="k">return</span> <span class="n">group</span><span class="p">;</span>
<a name="line-276"></a><span class="p">}</span>
<a name="line-277"></a>
<a name="line-278"></a><span class="cm">/**</span>
<a name="line-279"></a><span class="cm"> * egg_sm_client_set_mode:</span>
<a name="line-280"></a><span class="cm"> * @mode: an #EggSMClient mode</span>
<a name="line-281"></a><span class="cm"> *</span>
<a name="line-282"></a><span class="cm"> * Sets the &quot;mode&quot; of #EggSMClient as follows:</span>
<a name="line-283"></a><span class="cm"> *</span>
<a name="line-284"></a><span class="cm"> *    %EGG_SM_CLIENT_MODE_DISABLED: Session management is completely</span>
<a name="line-285"></a><span class="cm"> *    disabled, until the mode is changed again. The application will</span>
<a name="line-286"></a><span class="cm"> *    not even connect to the session manager. (egg_sm_client_get()</span>
<a name="line-287"></a><span class="cm"> *    will still return an #EggSMClient object.)</span>
<a name="line-288"></a><span class="cm"> *</span>
<a name="line-289"></a><span class="cm"> *    %EGG_SM_CLIENT_MODE_NO_RESTART: The application will connect to</span>
<a name="line-290"></a><span class="cm"> *    the session manager (and thus will receive notification when the</span>
<a name="line-291"></a><span class="cm"> *    user is logging out, etc), but will request to not be</span>
<a name="line-292"></a><span class="cm"> *    automatically restarted with saved state in future sessions.</span>
<a name="line-293"></a><span class="cm"> *</span>
<a name="line-294"></a><span class="cm"> *    %EGG_SM_CLIENT_MODE_NORMAL: The default. #EggSMCLient will</span>
<a name="line-295"></a><span class="cm"> *    function normally.</span>
<a name="line-296"></a><span class="cm"> *</span>
<a name="line-297"></a><span class="cm"> * This must be called before the application&#39;s main loop begins and</span>
<a name="line-298"></a><span class="cm"> * before any call to egg_sm_client_get(), unless the mode was set</span>
<a name="line-299"></a><span class="cm"> * earlier to %EGG_SM_CLIENT_MODE_DISABLED and this call enables</span>
<a name="line-300"></a><span class="cm"> * session management. Note that option parsing will call</span>
<a name="line-301"></a><span class="cm"> * egg_sm_client_get().</span>
<a name="line-302"></a><span class="cm"> **/</span>
<a name="line-303"></a><span class="kt">void</span>
<a name="line-304"></a><span class="n">egg_sm_client_set_mode</span> <span class="p">(</span><span class="n">EggSMClientMode</span> <span class="n">mode</span><span class="p">)</span>
<a name="line-305"></a><span class="p">{</span>
<a name="line-306"></a>    <span class="n">EggSMClientMode</span> <span class="n">old_mode</span> <span class="o">=</span> <span class="n">global_client_mode</span><span class="p">;</span>
<a name="line-307"></a>
<a name="line-308"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">global_client</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">global_client_mode</span> <span class="o">==</span> <span class="n">EGG_SM_CLIENT_MODE_DISABLED</span><span class="p">);</span>
<a name="line-309"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">global_client</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">mode</span> <span class="o">==</span> <span class="n">EGG_SM_CLIENT_MODE_DISABLED</span><span class="p">));</span>
<a name="line-310"></a>
<a name="line-311"></a>    <span class="n">global_client_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>
<a name="line-312"></a>
<a name="line-313"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">global_client</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">old_mode</span> <span class="o">==</span> <span class="n">EGG_SM_CLIENT_MODE_DISABLED</span><span class="p">)</span>
<a name="line-314"></a>    <span class="p">{</span>
<a name="line-315"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">global_client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span><span class="p">)</span>
<a name="line-316"></a>            <span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">global_client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">startup</span> <span class="p">(</span><span class="n">global_client</span><span class="p">,</span> <span class="n">sm_client_id</span><span class="p">);</span>
<a name="line-317"></a>    <span class="p">}</span>
<a name="line-318"></a><span class="p">}</span>
<a name="line-319"></a>
<a name="line-320"></a><span class="cm">/**</span>
<a name="line-321"></a><span class="cm"> * egg_sm_client_get_mode:</span>
<a name="line-322"></a><span class="cm"> *</span>
<a name="line-323"></a><span class="cm"> * Gets the global #EggSMClientMode. See egg_sm_client_set_mode()</span>
<a name="line-324"></a><span class="cm"> * for details.</span>
<a name="line-325"></a><span class="cm"> *</span>
<a name="line-326"></a><span class="cm"> * Return value: the global #EggSMClientMode</span>
<a name="line-327"></a><span class="cm"> **/</span>
<a name="line-328"></a><span class="n">EggSMClientMode</span>
<a name="line-329"></a><span class="n">egg_sm_client_get_mode</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a name="line-330"></a><span class="p">{</span>
<a name="line-331"></a>    <span class="k">return</span> <span class="n">global_client_mode</span><span class="p">;</span>
<a name="line-332"></a><span class="p">}</span>
<a name="line-333"></a>
<a name="line-334"></a><span class="cm">/**</span>
<a name="line-335"></a><span class="cm"> * egg_sm_client_get:</span>
<a name="line-336"></a><span class="cm"> *</span>
<a name="line-337"></a><span class="cm"> * Returns the master #EggSMClient for the application.</span>
<a name="line-338"></a><span class="cm"> *</span>
<a name="line-339"></a><span class="cm"> * On platforms that support saved sessions (ie, POSIX/X11), the</span>
<a name="line-340"></a><span class="cm"> * application will only request to be restarted by the session</span>
<a name="line-341"></a><span class="cm"> * manager if you call egg_set_desktop_file() to set an application</span>
<a name="line-342"></a><span class="cm"> * desktop file. In particular, if the desktop file contains the key</span>
<a name="line-343"></a><span class="cm"> * &quot;X</span>
<a name="line-344"></a><span class="cm"> *</span>
<a name="line-345"></a><span class="cm"> * Return value: the master #EggSMClient.</span>
<a name="line-346"></a><span class="cm"> **/</span>
<a name="line-347"></a><span class="n">EggSMClient</span> <span class="o">*</span>
<a name="line-348"></a><span class="n">egg_sm_client_get</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<a name="line-349"></a><span class="p">{</span>
<a name="line-350"></a><span class="hll">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">global_client</span><span class="p">)</span><span class="error2">&lt;--- Assuming that condition '!global_client' is not redundant</span><span class="error2">&lt;--- Assuming that condition '!global_client' is not redundant</span>
</span><a name="line-351"></a>    <span class="p">{</span>
<a name="line-352"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sm_client_disable</span><span class="p">)</span>
<a name="line-353"></a>        <span class="p">{</span>
<a name="line-354"></a>            <span class="cm">/* If both D-Bus and XSMP are compiled in, try XSMP first</span>
<a name="line-355"></a><span class="cm">             * (since it supports state saving) and fall back to D-Bus</span>
<a name="line-356"></a><span class="cm">             * if XSMP isn&#39;t available.</span>
<a name="line-357"></a><span class="cm">             */</span>
<a name="line-358"></a><span class="cp">#ifdef EGG_SM_CLIENT_BACKEND_XSMP</span>
<a name="line-359"></a>            <span class="n">global_client</span> <span class="o">=</span> <span class="n">egg_sm_client_xsmp_new</span> <span class="p">();</span>
<a name="line-360"></a><span class="cp">#endif</span>
<a name="line-361"></a><span class="cp">#ifdef EGG_SM_CLIENT_BACKEND_DBUS</span>
<a name="line-362"></a><span class="hll">            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">global_client</span><span class="p">)</span><span class="error2">&lt;--- Condition '!global_client' is always true</span>
</span><a name="line-363"></a>                <span class="n">global_client</span> <span class="o">=</span> <span class="n">egg_sm_client_dbus_new</span> <span class="p">();</span>
<a name="line-364"></a><span class="cp">#endif</span>
<a name="line-365"></a>        <span class="p">}</span>
<a name="line-366"></a>
<a name="line-367"></a>        <span class="cm">/* Fallback: create a dummy client, so that callers don&#39;t have</span>
<a name="line-368"></a><span class="cm">         * to worry about a %NULL return value.</span>
<a name="line-369"></a><span class="cm">         */</span>
<a name="line-370"></a><span class="hll">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">global_client</span><span class="p">)</span><span class="error2">&lt;--- Condition '!global_client' is always true</span>
</span><a name="line-371"></a>            <span class="n">global_client</span> <span class="o">=</span> <span class="n">g_object_new</span> <span class="p">(</span><span class="n">EGG_TYPE_SM_CLIENT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-372"></a>        <span class="cm">/*FIXME</span>
<a name="line-373"></a><span class="cm">          Disabling when root/not in MATE in GtkApplication builds</span>
<a name="line-374"></a><span class="cm">          as egg_sm_client_set_mode must be called prior to start of main loop</span>
<a name="line-375"></a><span class="cm">          to stop caja restart but this is diffcult in GtkApplication */</span>
<a name="line-376"></a>
<a name="line-377"></a>		<span class="k">if</span> <span class="p">(</span><span class="n">geteuid</span> <span class="p">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="o">!</span><span class="n">running_in_mate</span> <span class="p">()){</span>
<a name="line-378"></a>            <span class="n">global_client</span> <span class="o">=</span> <span class="n">g_object_new</span> <span class="p">(</span><span class="n">EGG_TYPE_SM_CLIENT</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-379"></a>        <span class="p">}</span>
<a name="line-380"></a>    <span class="p">}</span>
<a name="line-381"></a>
<a name="line-382"></a>    <span class="k">return</span> <span class="n">global_client</span><span class="p">;</span>
<a name="line-383"></a><span class="p">}</span>
<a name="line-384"></a>
<a name="line-385"></a><span class="cm">/**</span>
<a name="line-386"></a><span class="cm"> * egg_sm_client_is_resumed:</span>
<a name="line-387"></a><span class="cm"> * @client: the client</span>
<a name="line-388"></a><span class="cm"> *</span>
<a name="line-389"></a><span class="cm"> * Checks whether or not the current session has been resumed from</span>
<a name="line-390"></a><span class="cm"> * a previous saved session. If so, the application should call</span>
<a name="line-391"></a><span class="cm"> * egg_sm_client_get_state_file() and restore its state from the</span>
<a name="line-392"></a><span class="cm"> * returned #GKeyFile.</span>
<a name="line-393"></a><span class="cm"> *</span>
<a name="line-394"></a><span class="cm"> * Return value: %TRUE if the session has been resumed</span>
<a name="line-395"></a><span class="cm"> **/</span>
<a name="line-396"></a><span class="n">gboolean</span>
<a name="line-397"></a><span class="n">egg_sm_client_is_resumed</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-398"></a><span class="p">{</span>
<a name="line-399"></a>    <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">client</span> <span class="o">==</span> <span class="n">global_client</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">);</span>
<a name="line-400"></a>
<a name="line-401"></a>    <span class="k">return</span> <span class="n">sm_client_state_file</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-402"></a><span class="p">}</span>
<a name="line-403"></a>
<a name="line-404"></a><span class="cm">/**</span>
<a name="line-405"></a><span class="cm"> * egg_sm_client_get_state_file:</span>
<a name="line-406"></a><span class="cm"> * @client: the client</span>
<a name="line-407"></a><span class="cm"> *</span>
<a name="line-408"></a><span class="cm"> * If the application was resumed by the session manager, this will</span>
<a name="line-409"></a><span class="cm"> * return the #GKeyFile containing its state from the previous</span>
<a name="line-410"></a><span class="cm"> * session.</span>
<a name="line-411"></a><span class="cm"> *</span>
<a name="line-412"></a><span class="cm"> * Note that other libraries and #EggSMClient itself may also store</span>
<a name="line-413"></a><span class="cm"> * state in the key file, so if you call egg_sm_client_get_groups(),</span>
<a name="line-414"></a><span class="cm"> * on it, the return value will likely include groups that you did not</span>
<a name="line-415"></a><span class="cm"> * put there yourself. (It is also not guaranteed that the first</span>
<a name="line-416"></a><span class="cm"> * group created by the application will still be the &quot;start group&quot;</span>
<a name="line-417"></a><span class="cm"> * when it is resumed.)</span>
<a name="line-418"></a><span class="cm"> *</span>
<a name="line-419"></a><span class="cm"> * Return value: the #GKeyFile containing the application&#39;s earlier</span>
<a name="line-420"></a><span class="cm"> * state, or %NULL on error. You should not free this key file; it</span>
<a name="line-421"></a><span class="cm"> * is owned by @client.</span>
<a name="line-422"></a><span class="cm"> **/</span>
<a name="line-423"></a><span class="n">GKeyFile</span> <span class="o">*</span>
<a name="line-424"></a><span class="n">egg_sm_client_get_state_file</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-425"></a><span class="p">{</span>
<a name="line-426"></a>    <span class="n">EggSMClientPrivate</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">egg_sm_client_get_instance_private</span> <span class="p">(</span><span class="n">client</span><span class="p">);</span>
<a name="line-427"></a>    <span class="kt">char</span> <span class="o">*</span><span class="n">state_file_path</span><span class="p">;</span>
<a name="line-428"></a>    <span class="n">GError</span> <span class="o">*</span><span class="n">err</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-429"></a>
<a name="line-430"></a>    <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">client</span> <span class="o">==</span> <span class="n">global_client</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-431"></a>
<a name="line-432"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sm_client_state_file</span><span class="p">)</span>
<a name="line-433"></a>        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-434"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span><span class="p">)</span>
<a name="line-435"></a>        <span class="k">return</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span><span class="p">;</span>
<a name="line-436"></a>
<a name="line-437"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strncmp</span> <span class="p">(</span><span class="n">sm_client_state_file</span><span class="p">,</span> <span class="s">&quot;file://&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<a name="line-438"></a>        <span class="n">state_file_path</span> <span class="o">=</span> <span class="n">g_filename_from_uri</span> <span class="p">(</span><span class="n">sm_client_state_file</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-439"></a>    <span class="k">else</span>
<a name="line-440"></a>        <span class="n">state_file_path</span> <span class="o">=</span> <span class="n">g_strdup</span> <span class="p">(</span><span class="n">sm_client_state_file</span><span class="p">);</span>
<a name="line-441"></a>
<a name="line-442"></a>    <span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span> <span class="o">=</span> <span class="n">g_key_file_new</span> <span class="p">();</span>
<a name="line-443"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g_key_file_load_from_file</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span><span class="p">,</span> <span class="n">state_file_path</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">))</span>
<a name="line-444"></a>    <span class="p">{</span>
<a name="line-445"></a>        <span class="n">g_warning</span> <span class="p">(</span><span class="s">&quot;Could not load SM state file &#39;%s&#39;: %s&quot;</span><span class="p">,</span>
<a name="line-446"></a>                   <span class="n">sm_client_state_file</span><span class="p">,</span> <span class="n">err</span><span class="o">-&gt;</span><span class="n">message</span><span class="p">);</span>
<a name="line-447"></a>        <span class="n">g_clear_error</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">err</span><span class="p">);</span>
<a name="line-448"></a>        <span class="n">g_key_file_free</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span><span class="p">);</span>
<a name="line-449"></a>        <span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-450"></a>    <span class="p">}</span>
<a name="line-451"></a>
<a name="line-452"></a>    <span class="n">g_free</span> <span class="p">(</span><span class="n">state_file_path</span><span class="p">);</span>
<a name="line-453"></a>    <span class="k">return</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">state_file</span><span class="p">;</span>
<a name="line-454"></a><span class="p">}</span>
<a name="line-455"></a>
<a name="line-456"></a><span class="cm">/**</span>
<a name="line-457"></a><span class="cm"> * egg_sm_client_set_restart_command:</span>
<a name="line-458"></a><span class="cm"> * @client: the client</span>
<a name="line-459"></a><span class="cm"> * @argc: the length of @argv</span>
<a name="line-460"></a><span class="cm"> * @argv: argument vector</span>
<a name="line-461"></a><span class="cm"> *</span>
<a name="line-462"></a><span class="cm"> * Sets the command used to restart @client if it does not have a</span>
<a name="line-463"></a><span class="cm"> * .desktop file that can be used to find its restart command.</span>
<a name="line-464"></a><span class="cm"> *</span>
<a name="line-465"></a><span class="cm"> * This can also be used when handling the ::save_state signal, to</span>
<a name="line-466"></a><span class="cm"> * save the current state via an updated command line. (Eg, providing</span>
<a name="line-467"></a><span class="cm"> * a list of filenames to open when the application is resumed.)</span>
<a name="line-468"></a><span class="cm"> **/</span>
<a name="line-469"></a><span class="kt">void</span>
<a name="line-470"></a><span class="n">egg_sm_client_set_restart_command</span> <span class="p">(</span><span class="n">EggSMClient</span>  <span class="o">*</span><span class="n">client</span><span class="p">,</span>
<a name="line-471"></a>                                   <span class="kt">int</span>           <span class="n">argc</span><span class="p">,</span>
<a name="line-472"></a>                                   <span class="k">const</span> <span class="kt">char</span>  <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<a name="line-473"></a><span class="p">{</span>
<a name="line-474"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">EGG_IS_SM_CLIENT</span> <span class="p">(</span><span class="n">client</span><span class="p">));</span>
<a name="line-475"></a>
<a name="line-476"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">set_restart_command</span><span class="p">)</span>
<a name="line-477"></a>        <span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">set_restart_command</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
<a name="line-478"></a><span class="p">}</span>
<a name="line-479"></a>
<a name="line-480"></a><span class="cm">/**</span>
<a name="line-481"></a><span class="cm"> * egg_sm_client_set_discard_command:</span>
<a name="line-482"></a><span class="cm"> * @client: the client</span>
<a name="line-483"></a><span class="cm"> * @argc: the length of @argv</span>
<a name="line-484"></a><span class="cm"> * @argv: argument vector</span>
<a name="line-485"></a><span class="cm"> *</span>
<a name="line-486"></a><span class="cm"> * Sets the command used to discard a custom state file if using</span>
<a name="line-487"></a><span class="cm"> * egg_sm_client_set_restart_command(), which must be called before</span>
<a name="line-488"></a><span class="cm"> * using this function.</span>
<a name="line-489"></a><span class="cm"> **/</span>
<a name="line-490"></a><span class="kt">void</span>
<a name="line-491"></a><span class="n">egg_sm_client_set_discard_command</span> <span class="p">(</span><span class="n">EggSMClient</span>  <span class="o">*</span><span class="n">client</span><span class="p">,</span>
<a name="line-492"></a>                                   <span class="kt">int</span>           <span class="n">argc</span><span class="p">,</span>
<a name="line-493"></a>                                   <span class="k">const</span> <span class="kt">char</span>  <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<a name="line-494"></a><span class="p">{</span>
<a name="line-495"></a>	<span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">EGG_IS_SM_CLIENT</span> <span class="p">(</span><span class="n">client</span><span class="p">));</span>
<a name="line-496"></a>
<a name="line-497"></a>	<span class="k">if</span> <span class="p">(</span><span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">set_discard_command</span><span class="p">)</span>
<a name="line-498"></a>		<span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">set_discard_command</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">argc</span><span class="p">,</span> <span class="n">argv</span><span class="p">);</span>
<a name="line-499"></a><span class="p">}</span>
<a name="line-500"></a>
<a name="line-501"></a><span class="cm">/**</span>
<a name="line-502"></a><span class="cm"> * egg_sm_client_will_quit:</span>
<a name="line-503"></a><span class="cm"> * @client: the client</span>
<a name="line-504"></a><span class="cm"> * @will_quit: whether or not the application is willing to quit</span>
<a name="line-505"></a><span class="cm"> *</span>
<a name="line-506"></a><span class="cm"> * This MUST be called in response to the ::quit_requested signal, to</span>
<a name="line-507"></a><span class="cm"> * indicate whether or not the application is willing to quit. The</span>
<a name="line-508"></a><span class="cm"> * application may call it either directly from the signal handler, or</span>
<a name="line-509"></a><span class="cm"> * at some later point (eg, after asynchronously interacting with the</span>
<a name="line-510"></a><span class="cm"> * user).</span>
<a name="line-511"></a><span class="cm"> *</span>
<a name="line-512"></a><span class="cm"> * If the application does not connect to ::quit_requested,</span>
<a name="line-513"></a><span class="cm"> * #EggSMClient will call this method on its behalf (passing %TRUE</span>
<a name="line-514"></a><span class="cm"> * for @will_quit).</span>
<a name="line-515"></a><span class="cm"> *</span>
<a name="line-516"></a><span class="cm"> * After calling this method, the application should wait to receive</span>
<a name="line-517"></a><span class="cm"> * either ::quit_cancelled or ::quit.</span>
<a name="line-518"></a><span class="cm"> **/</span>
<a name="line-519"></a><span class="kt">void</span>
<a name="line-520"></a><span class="n">egg_sm_client_will_quit</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
<a name="line-521"></a>                         <span class="n">gboolean</span>     <span class="n">will_quit</span><span class="p">)</span>
<a name="line-522"></a><span class="p">{</span>
<a name="line-523"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">EGG_IS_SM_CLIENT</span> <span class="p">(</span><span class="n">client</span><span class="p">));</span>
<a name="line-524"></a>
<a name="line-525"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">will_quit</span><span class="p">)</span>
<a name="line-526"></a>        <span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">will_quit</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">will_quit</span><span class="p">);</span>
<a name="line-527"></a><span class="p">}</span>
<a name="line-528"></a>
<a name="line-529"></a><span class="cm">/**</span>
<a name="line-530"></a><span class="cm"> * egg_sm_client_end_session:</span>
<a name="line-531"></a><span class="cm"> * @style: a hint at how to end the session</span>
<a name="line-532"></a><span class="cm"> * @request_confirmation: whether or not the user should get a chance</span>
<a name="line-533"></a><span class="cm"> * to confirm the action</span>
<a name="line-534"></a><span class="cm"> *</span>
<a name="line-535"></a><span class="cm"> * Requests that the session manager end the current session. @style</span>
<a name="line-536"></a><span class="cm"> * indicates how the session should be ended, and</span>
<a name="line-537"></a><span class="cm"> * @request_confirmation indicates whether or not the user should be</span>
<a name="line-538"></a><span class="cm"> * given a chance to confirm the logout/reboot/shutdown. Both of these</span>
<a name="line-539"></a><span class="cm"> * flags are merely hints though; the session manager may choose to</span>
<a name="line-540"></a><span class="cm"> * ignore them.</span>
<a name="line-541"></a><span class="cm"> *</span>
<a name="line-542"></a><span class="cm"> * Return value: %TRUE if the request was sent; %FALSE if it could not</span>
<a name="line-543"></a><span class="cm"> * be (eg, because it could not connect to the session manager).</span>
<a name="line-544"></a><span class="cm"> **/</span>
<a name="line-545"></a><span class="n">gboolean</span>
<a name="line-546"></a><span class="n">egg_sm_client_end_session</span> <span class="p">(</span><span class="n">EggSMClientEndStyle</span>  <span class="n">style</span><span class="p">,</span>
<a name="line-547"></a>                           <span class="n">gboolean</span>             <span class="n">request_confirmation</span><span class="p">)</span>
<a name="line-548"></a><span class="p">{</span>
<a name="line-549"></a>    <span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">egg_sm_client_get</span> <span class="p">();</span>
<a name="line-550"></a>
<a name="line-551"></a>    <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">EGG_IS_SM_CLIENT</span> <span class="p">(</span><span class="n">client</span><span class="p">),</span> <span class="n">FALSE</span><span class="p">);</span>
<a name="line-552"></a>
<a name="line-553"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_session</span><span class="p">)</span>
<a name="line-554"></a>    <span class="p">{</span>
<a name="line-555"></a>        <span class="k">return</span> <span class="nf">EGG_SM_CLIENT_GET_CLASS</span> <span class="p">(</span><span class="n">client</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">end_session</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span>
<a name="line-556"></a>                <span class="n">request_confirmation</span><span class="p">);</span>
<a name="line-557"></a>    <span class="p">}</span>
<a name="line-558"></a>    <span class="k">else</span>
<a name="line-559"></a>        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<a name="line-560"></a><span class="p">}</span>
<a name="line-561"></a>
<a name="line-562"></a><span class="cm">/* Signal-emitting callbacks from platform-specific code */</span>
<a name="line-563"></a>
<a name="line-564"></a><span class="n">GKeyFile</span> <span class="o">*</span>
<a name="line-565"></a><span class="n">egg_sm_client_save_state</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-566"></a><span class="p">{</span>
<a name="line-567"></a>    <span class="n">GKeyFile</span> <span class="o">*</span><span class="n">state_file</span><span class="p">;</span>
<a name="line-568"></a>    <span class="kt">char</span> <span class="o">*</span><span class="n">group</span><span class="p">;</span>
<a name="line-569"></a>
<a name="line-570"></a>    <span class="n">g_return_val_if_fail</span> <span class="p">(</span><span class="n">client</span> <span class="o">==</span> <span class="n">global_client</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-571"></a>
<a name="line-572"></a>    <span class="n">state_file</span> <span class="o">=</span> <span class="n">g_key_file_new</span> <span class="p">();</span>
<a name="line-573"></a>
<a name="line-574"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Emitting save_state&quot;</span><span class="p">);</span>
<a name="line-575"></a>    <span class="n">g_signal_emit</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">signals</span><span class="p">[</span><span class="n">SAVE_STATE</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state_file</span><span class="p">);</span>
<a name="line-576"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Done emitting save_state&quot;</span><span class="p">);</span>
<a name="line-577"></a>
<a name="line-578"></a>    <span class="n">group</span> <span class="o">=</span> <span class="n">g_key_file_get_start_group</span> <span class="p">(</span><span class="n">state_file</span><span class="p">);</span>
<a name="line-579"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">group</span><span class="p">)</span>
<a name="line-580"></a>    <span class="p">{</span>
<a name="line-581"></a>        <span class="n">g_free</span> <span class="p">(</span><span class="n">group</span><span class="p">);</span>
<a name="line-582"></a>        <span class="k">return</span> <span class="n">state_file</span><span class="p">;</span>
<a name="line-583"></a>    <span class="p">}</span>
<a name="line-584"></a>    <span class="k">else</span>
<a name="line-585"></a>    <span class="p">{</span>
<a name="line-586"></a>        <span class="n">g_key_file_free</span> <span class="p">(</span><span class="n">state_file</span><span class="p">);</span>
<a name="line-587"></a>        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<a name="line-588"></a>    <span class="p">}</span>
<a name="line-589"></a><span class="p">}</span>
<a name="line-590"></a>
<a name="line-591"></a><span class="kt">void</span>
<a name="line-592"></a><span class="n">egg_sm_client_quit_requested</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-593"></a><span class="p">{</span>
<a name="line-594"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">client</span> <span class="o">==</span> <span class="n">global_client</span><span class="p">);</span>
<a name="line-595"></a>
<a name="line-596"></a>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">g_signal_has_handler_pending</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">signals</span><span class="p">[</span><span class="n">QUIT_REQUESTED</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">FALSE</span><span class="p">))</span>
<a name="line-597"></a>    <span class="p">{</span>
<a name="line-598"></a>        <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Not emitting quit_requested because no one is listening&quot;</span><span class="p">);</span>
<a name="line-599"></a>        <span class="n">egg_sm_client_will_quit</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">TRUE</span><span class="p">);</span>
<a name="line-600"></a>        <span class="k">return</span><span class="p">;</span>
<a name="line-601"></a>    <span class="p">}</span>
<a name="line-602"></a>
<a name="line-603"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Emitting quit_requested&quot;</span><span class="p">);</span>
<a name="line-604"></a>    <span class="n">g_signal_emit</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">signals</span><span class="p">[</span><span class="n">QUIT_REQUESTED</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-605"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Done emitting quit_requested&quot;</span><span class="p">);</span>
<a name="line-606"></a><span class="p">}</span>
<a name="line-607"></a>
<a name="line-608"></a><span class="kt">void</span>
<a name="line-609"></a><span class="n">egg_sm_client_quit_cancelled</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-610"></a><span class="p">{</span>
<a name="line-611"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">client</span> <span class="o">==</span> <span class="n">global_client</span><span class="p">);</span>
<a name="line-612"></a>
<a name="line-613"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Emitting quit_cancelled&quot;</span><span class="p">);</span>
<a name="line-614"></a>    <span class="n">g_signal_emit</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">signals</span><span class="p">[</span><span class="n">QUIT_CANCELLED</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-615"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Done emitting quit_cancelled&quot;</span><span class="p">);</span>
<a name="line-616"></a><span class="p">}</span>
<a name="line-617"></a>
<a name="line-618"></a><span class="kt">void</span>
<a name="line-619"></a><span class="n">egg_sm_client_quit</span> <span class="p">(</span><span class="n">EggSMClient</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<a name="line-620"></a><span class="p">{</span>
<a name="line-621"></a>    <span class="n">g_return_if_fail</span> <span class="p">(</span><span class="n">client</span> <span class="o">==</span> <span class="n">global_client</span><span class="p">);</span>
<a name="line-622"></a>
<a name="line-623"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Emitting quit&quot;</span><span class="p">);</span>
<a name="line-624"></a>    <span class="n">g_signal_emit</span> <span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">signals</span><span class="p">[</span><span class="n">QUIT</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
<a name="line-625"></a>    <span class="n">g_debug</span> <span class="p">(</span><span class="s">&quot;Done emitting quit&quot;</span><span class="p">);</span>
<a name="line-626"></a>
<a name="line-627"></a>    <span class="cm">/* FIXME: should we just call gtk_main_quit() here? */</span>
<a name="line-628"></a><span class="p">}</span>
<a name="line-629"></a>
<a name="line-630"></a><span class="k">static</span> <span class="kt">void</span>
<a name="line-631"></a><span class="n">egg_sm_client_debug_handler</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">log_domain</span><span class="p">,</span>
<a name="line-632"></a>                             <span class="n">GLogLevelFlags</span> <span class="n">log_level</span><span class="p">,</span>
<a name="line-633"></a>                             <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span>
<a name="line-634"></a>                             <span class="n">gpointer</span> <span class="n">user_data</span><span class="p">)</span>
<a name="line-635"></a><span class="p">{</span>
<a name="line-636"></a>    <span class="k">static</span> <span class="kt">int</span> <span class="n">debug</span> <span class="o">=</span> <span class="mi">-1</span><span class="p">;</span>
<a name="line-637"></a>
<a name="line-638"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">debug</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
<a name="line-639"></a>        <span class="n">debug</span> <span class="o">=</span> <span class="p">(</span><span class="n">g_getenv</span> <span class="p">(</span><span class="s">&quot;EGG_SM_CLIENT_DEBUG&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-640"></a>
<a name="line-641"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span>
<a name="line-642"></a>        <span class="n">g_log_default_handler</span> <span class="p">(</span><span class="n">log_domain</span><span class="p">,</span> <span class="n">log_level</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<a name="line-643"></a><span class="p">}</span>
</pre></div>
</td></tr></table>
      </div> <!-- /.wrapper -->
    </div>
    <div id="footer" class="footer">
      <p>
        Cppcheck 2.3 - a tool for static C/C++ code analysis<br>
        <br>
        Internet: <a href="http://cppcheck.net">http://cppcheck.net</a><br>
        IRC: <a href="irc://irc.freenode.net/cppcheck">irc://irc.freenode.net/cppcheck</a><br>
      </p>
    </div>
  </body>
</html>
